<!DOCTYPE html>
<html>
<head>
    <title>VR Whack-a-Mole Game</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #87CEEB" vr-mode-ui="enabled: true">
        <!-- Assets -->
        <a-assets>
            <a-mixin id="mole-animation" 
                     animation__up="property: position; to: 0 1 0; dur: 500; easing: easeOutQuad"
                     animation__down="property: position; to: 0 -0.5 0; dur: 300; easing: easeInQuad; startEvents: hide">
            </a-mixin>
        </a-assets>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="2 4 2" color="#ffffff"></a-light>

        <!-- Ground -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#228B22"></a-plane>

        <!-- Game Board - 9 holes in 3x3 grid -->
        <!-- Row 1 -->
        <a-cylinder id="hole1" position="-2 -0.1 -2" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>
        <a-cylinder id="hole2" position="0 -0.1 -2" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>
        <a-cylinder id="hole3" position="2 -0.1 -2" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>

        <!-- Row 2 -->
        <a-cylinder id="hole4" position="-2 -0.1 0" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>
        <a-cylinder id="hole5" position="0 -0.1 0" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>
        <a-cylinder id="hole6" position="2 -0.1 0" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>

        <!-- Row 3 -->
        <a-cylinder id="hole7" position="-2 -0.1 2" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>
        <a-cylinder id="hole8" position="0 -0.1 2" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>
        <a-cylinder id="hole9" position="2 -0.1 2" radius="0.6" height="0.2" color="#8B4513"></a-cylinder>

        <!-- Moles (initially hidden) -->
        <!-- Box Moles -->
        <a-box id="mole1" mixin="mole-animation" position="-2 -0.5 -2" width="0.8" height="0.8" depth="0.8" 
               color="#8B4513" class="mole" visible="false"
               cursor="rayOrigin: mouse" 
               raycaster="objects: .mole">
        </a-box>

        <a-box id="mole3" mixin="mole-animation" position="2 -0.5 -2" width="0.8" height="0.8" depth="0.8" 
               color="#8B4513" class="mole" visible="false"
               cursor="rayOrigin: mouse" 
               raycaster="objects: .mole">
        </a-box>

        <a-box id="mole5" mixin="mole-animation" position="0 -0.5 0" width="0.8" height="0.8" depth="0.8" 
               color="#8B4513" class="mole" visible="false"
               cursor="rayOrigin: mouse" 
               raycaster="objects: .mole">
        </a-box>

        <a-box id="mole7" mixin="mole-animation" position="-2 -0.5 2" width="0.8" height="0.8" depth="0.8" 
               color="#8B4513" class="mole" visible="false"
               cursor="rayOrigin: mouse" 
               raycaster="objects: .mole">
        </a-box>

        <a-box id="mole9" mixin="mole-animation" position="2 -0.5 2" width="0.8" height="0.8" depth="0.8" 
               color="#8B4513" class="mole" visible="false"
               cursor="rayOrigin: mouse" 
               raycaster="objects: .mole">
        </a-box>

        <!-- Sphere Moles -->
        <a-sphere id="mole2" mixin="mole-animation" position="0 -0.5 -2" radius="0.4" 
                  color="#654321" class="mole" visible="false"
                  cursor="rayOrigin: mouse" 
                  raycaster="objects: .mole">
        </a-sphere>

        <a-sphere id="mole4" mixin="mole-animation" position="-2 -0.5 0" radius="0.4" 
                  color="#654321" class="mole" visible="false"
                  cursor="rayOrigin: mouse" 
                  raycaster="objects: .mole">
        </a-sphere>

        <a-sphere id="mole6" mixin="mole-animation" position="2 -0.5 0" radius="0.4" 
                  color="#654321" class="mole" visible="false"
                  cursor="rayOrigin: mouse" 
                  raycaster="objects: .mole">
        </a-sphere>

        <a-sphere id="mole8" mixin="mole-animation" position="0 -0.5 2" radius="0.4" 
                  color="#654321" class="mole" visible="false"
                  cursor="rayOrigin: mouse" 
                  raycaster="objects: .mole">
        </a-sphere>

        <!-- Score Display -->
        <a-text id="score" position="-1 3 -3" value="Score: 0" color="white" align="center" 
                width="8" font="dejavu"></a-text>

        <!-- Timer Display -->
        <a-text id="timer" position="1 3 -3" value="Time: 60" color="white" align="center" 
                width="8" font="dejavu"></a-text>

        <!-- Camera with cursor for VR -->
        <a-camera position="0 1.6 4" look-controls wasd-controls>
            <a-cursor position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: white; shader: flat" 
                      animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                      animation__fuse="property: scale; startEvents: fuse; from: 1 1 1; to: 1.2 1.2 1.2; dur: 150"
                      raycaster="objects: .mole">
            </a-cursor>
        </a-camera>
    </a-scene>

    <script>
        // Game variables
        let score = 0;
        let timeLeft = 60;
        let gameActive = true;
        let activeMoles = [];

        // Get DOM elements
        const scoreDisplay = document.querySelector('#score');
        const timerDisplay = document.querySelector('#timer');
        const moles = document.querySelectorAll('.mole');

        // Add click listeners to all moles
        moles.forEach(mole => {
            mole.addEventListener('click', hitMole);
            mole.addEventListener('fuse', hitMole); // For gaze interaction
        });

        // Hit mole function
        function hitMole(event) {
            if (!gameActive) return;
            
            const mole = event.target;
            if (mole.getAttribute('visible')) {
                // Hide the mole
                mole.setAttribute('visible', false);
                mole.emit('hide');
                
                // Update score
                score += 10;
                scoreDisplay.setAttribute('value', `Score: ${score}`);
                
                // Remove from active moles
                const index = activeMoles.indexOf(mole);
                if (index > -1) {
                    activeMoles.splice(index, 1);
                }
                
                // Visual feedback
                mole.setAttribute('color', '#FF0000');
                setTimeout(() => {
                    mole.setAttribute('color', mole.id.includes('mole1') || 
                                              mole.id.includes('mole3') || 
                                              mole.id.includes('mole5') || 
                                              mole.id.includes('mole7') || 
                                              mole.id.includes('mole9') ? '#8B4513' : '#654321');
                }, 200);
            }
        }

        // Show random mole
        function showRandomMole() {
            if (!gameActive) return;
            
            // Don't show too many moles at once
            if (activeMoles.length >= 3) return;
            
            // Get available moles (not currently visible)
            const availableMoles = Array.from(moles).filter(mole => 
                !mole.getAttribute('visible') && !activeMoles.includes(mole)
            );
            
            if (availableMoles.length === 0) return;
            
            // Pick random mole
            const randomIndex = Math.floor(Math.random() * availableMoles.length);
            const selectedMole = availableMoles[randomIndex];
            
            // Show the mole
            selectedMole.setAttribute('visible', true);
            selectedMole.setAttribute('animation__up', 'startEvents: none');
            selectedMole.emit('animation__up');
            activeMoles.push(selectedMole);
            
            // Hide mole after random time (1-3 seconds)
            const hideTime = Math.random() * 2000 + 1000;
            setTimeout(() => {
                if (selectedMole.getAttribute('visible') && gameActive) {
                    selectedMole.setAttribute('visible', false);
                    selectedMole.emit('hide');
                    const index = activeMoles.indexOf(selectedMole);
                    if (index > -1) {
                        activeMoles.splice(index, 1);
                    }
                }
            }, hideTime);
        }

        // Game timer
        function updateTimer() {
            if (!gameActive) return;
            
            timeLeft--;
            timerDisplay.setAttribute('value', `Time: ${timeLeft}`);
            
            if (timeLeft <= 0) {
                endGame();
            }
        }

        // End game
        function endGame() {
            gameActive = false;
            
            // Hide all moles
            moles.forEach(mole => {
                mole.setAttribute('visible', false);
            });
            
            // Show final score
            setTimeout(() => {
                timerDisplay.setAttribute('value', `Game Over!`);
                scoreDisplay.setAttribute('value', `Final Score: ${score}`);
            }, 500);
        }

        // Start game
        function startGame() {
            // Show moles every 800ms to 1500ms
            const moleInterval = setInterval(() => {
                if (gameActive) {
                    showRandomMole();
                } else {
                    clearInterval(moleInterval);
                }
            }, Math.random() * 700 + 800);
            
            // Update timer every second
            const timerInterval = setInterval(() => {
                if (gameActive) {
                    updateTimer();
                } else {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        // Start the game after scene loads
        document.querySelector('a-scene').addEventListener('loaded', () => {
            setTimeout(startGame, 1000);
        });
    </script>
</body>
</html>
