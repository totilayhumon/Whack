<!DOCTYPE html>
<html>
<head>
    <title>VR Whack-a-Mole Game</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #87CEEB" vr-mode-ui="enabled: true">
        <a-assets>
            <a-mixin id="mole-animation" 
                     animation__up="property: position; dur: 500; easing: easeOutQuad"
                     animation__down="property: position; dur: 300; easing: easeInQuad; startEvents: hide">
            </a-mixin>
        </a-assets>

        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="2 4 2" color="#ffffff"></a-light>

        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#228B22"></a-plane>

        <a-circle id="hole1" position="-2 0.01 -2" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole2" position="0 0.01 -2" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole3" position="2 0.01 -2" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole4" position="-2 0.01 0" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole5" position="0 0.01 0" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole6" position="2 0.01 0" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole7" position="-2 0.01 2" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole8" position="0 0.01 2" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>
        <a-circle id="hole9" position="2 0.01 2" rotation="-90 0 0" radius="0.6" color="#1a1a1a"></a-circle>

        <a-ring position="-2 0.02 -2" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="0 0.02 -2" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="2 0.02 -2" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="-2 0.02 0" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="0 0.02 0" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="2 0.02 0" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="-2 0.02 2" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="0 0.02 2" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>
        <a-ring position="2 0.02 2" rotation="-90 0 0" radius-inner="0.6" radius-outer="0.8" color="#8B4513"></a-ring>

        <a-box id="mole1" mixin="mole-animation" position="-2 -0.6 -2" width="0.8" height="0.8" depth="0.8" color="#8B4513" class="mole" visible="true"></a-box>
        <a-sphere id="mole2" mixin="mole-animation" position="0 -0.6 -2" radius="0.4" color="#D2691E" class="mole" visible="true"></a-sphere>
        <a-box id="mole3" mixin="mole-animation" position="2 -0.6 -2" width="0.8" height="0.8" depth="0.8" color="#8B4513" class="mole" visible="true"></a-box>
        <a-sphere id="mole4" mixin="mole-animation" position="-2 -0.6 0" radius="0.4" color="#D2691E" class="mole" visible="true"></a-sphere>
        <a-box id="mole5" mixin="mole-animation" position="0 -0.6 0" width="0.8" height="0.8" depth="0.8" color="#8B4513" class="mole" visible="true"></a-box>
        <a-sphere id="mole6" mixin="mole-animation" position="2 -0.6 0" radius="0.4" color="#D2691E" class="mole" visible="true"></a-sphere>
        <a-box id="mole7" mixin="mole-animation" position="-2 -0.6 2" width="0.8" height="0.8" depth="0.8" color="#8B4513" class="mole" visible="true"></a-box>
        <a-sphere id="mole8" mixin="mole-animation" position="0 -0.6 2" radius="0.4" color="#D2691E" class="mole" visible="true"></a-sphere>
        <a-box id="mole9" mixin="mole-animation" position="2 -0.6 2" width="0.8" height="0.8" depth="0.8" color="#8B4513" class="mole" visible="true"></a-box>

        <a-entity id="intro-screen" position="0 2 -4" visible="true">
            <a-text position="0 1 0" value="VR WHACK-A-MOLE" color="#FFD700" align="center" width="12"></a-text>
            <a-text position="0 0.3 0" value="Click or gaze at moles when they pop up!" color="white" align="center" width="8"></a-text>
            <a-text position="0 -0.2 0" value="10 points per mole - 60 seconds to play" color="white" align="center" width="8"></a-text>
            <a-text id="intro-start" position="0 -0.8 0" value="Game starts in 3 seconds..." color="#00FF00" align="center" width="8"></a-text>
        </a-entity>

        <a-entity id="game-ui" visible="false">
            <a-text id="score" position="-1.5 3 -3" value="Score: 0" color="white" align="center" width="8"></a-text>
            <a-text id="timer" position="1.5 3 -3" value="Time: 60" color="white" align="center" width="8"></a-text>
        </a-entity>

        <a-entity id="game-over-screen" position="0 2 -4" visible="false">
            <a-text position="0 0.5 0" value="GAME OVER!" color="#FF4444" align="center" width="12"></a-text>
            <a-text id="final-score" position="0 -0.2 0" value="Final Score: 0" color="white" align="center" width="10"></a-text>
            <a-text position="0 -0.8 0" value="Refresh page to play again" color="#00FF00" align="center" width="8"></a-text>
        </a-entity>

        <a-camera position="0 1.6 4" look-controls wasd-controls>
            <a-cursor position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: white; shader: flat" raycaster="objects: .mole">
            </a-cursor>
        </a-camera>
    </a-scene>

    <script>
        let score = 0, timeLeft = 60, gameActive = false, activeMoles = [], countdownTimer = 3;

        const molePositions = [
            { down: "-2 -0.6 -2", up: "-2 0.6 -2" }, { down: "0 -0.6 -2", up: "0 0.4 -2" }, { down: "2 -0.6 -2", up: "2 0.6 -2" },
            { down: "-2 -0.6 0", up: "-2 0.4 0" }, { down: "0 -0.6 0", up: "0 0.6 0" }, { down: "2 -0.6 0", up: "2 0.4 0" },
            { down: "-2 -0.6 2", up: "-2 0.6 2" }, { down: "0 -0.6 2", up: "0 0.4 2" }, { down: "2 -0.6 2", up: "2 0.6 2" }
        ];

        const elements = {
            score: document.querySelector('#score'),
            timer: document.querySelector('#timer'),
            moles: document.querySelectorAll('.mole'),
            introScreen: document.querySelector('#intro-screen'),
            gameUI: document.querySelector('#game-ui'),
            gameOverScreen: document.querySelector('#game-over-screen'),
            introStart: document.querySelector('#intro-start'),
            finalScore: document.querySelector('#final-score')
        };

        let moleStates = new Array(9).fill(false);

        elements.moles.forEach((mole, index) => {
            mole.addEventListener('click', () => hitMole(index));
            mole.addEventListener('fuse', () => hitMole(index));
        });

        function startCountdown() {
            const interval = setInterval(() => {
                if (countdownTimer > 0) {
                    elements.introStart.setAttribute('value', `Game starts in ${countdownTimer} seconds...`);
                    countdownTimer--;
                } else {
                    clearInterval(interval);
                    startGame();
                }
            }, 1000);
        }

        function hitMole(index) {
            if (!gameActive || !moleStates[index]) return;
            hideMole(index);
            score += 10;
            elements.score.setAttribute('value', `Score: ${score}`);
            const mole = elements.moles[index];
            const color = mole.getAttribute('color');
            mole.setAttribute('color', '#FF0000');
            setTimeout(() => mole.setAttribute('color', color), 200);
        }

        function showMole(index) {
            const mole = elements.moles[index];
            mole.setAttribute('animation__up', `to: ${molePositions[index].up}; startEvents: popup`);
            mole.emit('popup');
            moleStates[index] = true;
            activeMoles.push(index);
        }

        function hideMole(index) {
            const mole = elements.moles[index];
            mole.setAttribute('animation__down', `to: ${molePositions[index].down}; startEvents: hide`);
            mole.emit('hide');
            moleStates[index] = false;
            const i = activeMoles.indexOf(index);
            if (i > -1) activeMoles.splice(i, 1);
        }

        function showRandomMole() {
            if (!gameActive || activeMoles.length >= 3) return;
            const available = moleStates.map((state, i) => !state ? i : null).filter(i => i !== null);
            if (available.length === 0) return;
            const index = available[Math.floor(Math.random() * available.length)];
            showMole(index);
            setTimeout(() => {
                if (moleStates[index] && gameActive) hideMole(index);
            }, Math.random() * 1500 + 1500);
        }

        function updateTimer() {
            if (!gameActive) return;
            timeLeft--;
            elements.timer.setAttribute('value', `Time: ${timeLeft}`);
            if (timeLeft <= 0) endGame();
        }

        function endGame() {
            gameActive = false;
            for (let i = 0; i < 9; i++) {
                if (moleStates[i]) hideMole(i);
            }
            setTimeout(() => {
                elements.gameUI.setAttribute('visible', false);
                elements.gameOverScreen.setAttribute('visible', true);
                elements.finalScore.setAttribute('value', `Final Score: ${score}`);
            }, 500);
        }

        function startGame() {
            gameActive = true;
            elements.introScreen.setAttribute('visible', false);
            elements.gameUI.setAttribute('visible', true);
            
            setInterval(() => {
                if (gameActive) showRandomMole();
            }, Math.random() * 1000 + 1000);
            
            setInterval(() => {
                if (gameActive) updateTimer();
            }, 1000);
        }

        document.querySelector('a-scene').addEventListener('loaded', () => {
            setTimeout(startGame, 1000);
        });
    </script>
</body>
</html>
